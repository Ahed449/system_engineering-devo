#!/usr/bin/env bash
# This script lists all processes for all users, including those without a TTY, in a user-friendly hierarchical format.

set -Eeuo pipefail

if ps -eo pid --forest >/dev/null 2>&1; then
  ps -eo user:18,pid,ppid,%cpu,%mem,tty,start,time,cmd --forest
  exit 0
fi

if command -v pstree >/dev/null 2>&1; then
  echo "Note: ps --forest not available; showing pstree first, then a flat ps list." >&2
  pstree -apu
  echo
  ps -eo user:18,pid,ppid,%cpu,%mem,tty,start,time,cmd
  exit 0
fi

echo "Neither 'ps --forest' nor 'pstree' is available. Please install 'procps' or 'pstree'." >&2
exit 1
